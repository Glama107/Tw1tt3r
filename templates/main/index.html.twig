{% extends 'base.html.twig' %}

{% block title %}Hello MainController!{% endblock %}

{% block body %}
    {{ include('_includes/navigation.html.twig') }}
    <div class="max-w-xl mx-auto mt-28">
        {% if app.user and app.user.verified %}
            <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-4 my-4">
                {{ form_start(form) }}
                <div class="mb-4">
                    <label class="block text-gray-700 font-bold mb-2 dark:text-gray-200" for="tweet_content">Say
                        something funny</label>
                    {{ form_widget(form.content) }}
                </div>
                <div class="flex items-center">
                    <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="submit">Post
                    </button>
                </div>
                {{ form_end(form) }}
            </div>
        {% elseif not app.user %}
            <div class="bg-blue-100 border border-blue-400 text-gray-700 px-4 py-3 rounded mb-4" role="alert">
                You have to be logged in to post a tweet.
            </div>
        {% else %}
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4" role="alert">
                Verify your email address to post a tweet.
            </div>
        {% endif %}
        {% for message in app.flashes('success') %}

            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4" role="alert">
                {{ message }}
            </div>
        {% endfor %}
        <div>
            <h2 class="text-xl font-bold mb-4 dark:text-gray-200">Recent Tweets</h2>
            <ul>
                {% if articles|length == 0 %}
                    <li class="border border-gray-200 rounded-lg p-4 my-4">
                        <p class="text-gray-500">No tweets found.</p>
                    </li>
                {% endif %}
                {% for article in articles|reverse %}
                    {{ include('_includes/article.html.twig') }}
                {% endfor %}
            </ul>
        </div>
    </div>

    <script>
        // app.js

        const likeButtons = document.querySelectorAll('#like-button');
        const likedImage = document.querySelectorAll('#liked-image');

        likeButtons.forEach(likeButton => {
            const articleId = likeButton.dataset.articleId;

            likeButton.addEventListener('click', () => {
                fetch(`/article/${articleId}/like`, {
                    method: 'POST',
                })
                    .then(response => response.json())
                    .then(data => {
                        const likesCount = likeButton.parentNode.querySelector('#like-count');
                        likesCount.textContent = data.likes;
                        window.location.reload();
                    });
            });
        });
    </script>
{% endblock %}
